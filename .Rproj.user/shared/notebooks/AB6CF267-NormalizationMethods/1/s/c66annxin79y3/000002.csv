"0","library(BatchNorm)
# Import unfiltered Seurat object (included with 'BatchNorm' package)
data(PBMCs)

# Filter sample by mitochondrial percentage (+5 SD)
PBMCs <- MitoFilter(PBMCs)
# Run ""standard"" Seurat workflow on a list of samples, independently:
# Including data normalization, variable gene selection and gene scaling (performed on each sample individually, prior to merging samples for joint analysis)
PBMCs.list <- SplitObject(PBMCs, split.by = ""orig.ident"")
features.list <- list()
# Normalize data & select highly variable transcripts
for (i in 1:length(PBMCs.list)) {
    PBMCs.list[[i]] <- PBMCs.list[[i]] %>% 
                       NormalizeData(normalization.method = ""LogNormalize"", 
                                     assay = ""RNA"", scale.factor = 10000) %>% 
                       NormalizeData(normalization.method = ""CLR"", 
                                     assay = ""ADT"") %>%
                       FindVariableFeatures(selection.method = ""vst"", 
                                            nfeatures = 2000)
    features.list[[i]] <- PBMCs.list[[i]]@assays$RNA@var.features
}
"
"2","Performing log-normalization
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"1",""
"1"," "
"1"," |                                                  |"
"1"," "
"1","0 % ~calculating  "
"1",""
"1"," "
"1"," |+++                                               |"
"1"," "
"1","5 % ~00s          "
"1",""
"1"," "
"1"," |+++++                                             |"
"1"," "
"1","10% ~00s          "
"1",""
"1"," "
"1"," |++++++++                                          |"
"1"," "
"1","15% ~00s          "
"1",""
"1"," "
"1"," |++++++++++                                        |"
"1"," "
"1","20% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++                                     |"
"1"," "
"1","25% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++                                   |"
"1"," "
"1","30% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++                                |"
"1"," "
"1","35% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++                              |"
"1"," "
"1","40% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++                           |"
"1"," "
"1","45% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++                         |"
"1"," "
"1","50% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++                      |"
"1"," "
"1","55% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++                    |"
"1"," "
"1","60% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++                 |"
"1"," "
"1","65% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++               |"
"1"," "
"1","70% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++            |"
"1"," "
"1","75% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++          |"
"1"," "
"1","80% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++       |"
"1"," "
"1","85% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++++     |"
"1"," "
"1","90% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++  |"
"1"," "
"1","95% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++++|"
"1"," "
"1","100% elapsed=00s  "
"1","
"
"2","Calculating gene variances"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"2","Calculating feature variances of standardized and clipped values"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"2","Performing log-normalization
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"1",""
"1"," "
"1"," |                                                  |"
"1"," "
"1","0 % ~calculating  "
"1",""
"1"," "
"1"," |+++                                               |"
"1"," "
"1","5 % ~00s          "
"1",""
"1"," "
"1"," |+++++                                             |"
"1"," "
"1","10% ~00s          "
"1",""
"1"," "
"1"," |++++++++                                          |"
"1"," "
"1","15% ~00s          "
"1",""
"1"," "
"1"," |++++++++++                                        |"
"1"," "
"1","20% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++                                     |"
"1"," "
"1","25% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++                                   |"
"1"," "
"1","30% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++                                |"
"1"," "
"1","35% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++                              |"
"1"," "
"1","40% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++                           |"
"1"," "
"1","45% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++                         |"
"1"," "
"1","50% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++                      |"
"1"," "
"1","55% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++                    |"
"1"," "
"1","60% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++                 |"
"1"," "
"1","65% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++               |"
"1"," "
"1","70% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++            |"
"1"," "
"1","75% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++          |"
"1"," "
"1","80% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++       |"
"1"," "
"1","85% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++++     |"
"1"," "
"1","90% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++  |"
"1"," "
"1","95% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++++|"
"1"," "
"1","100% elapsed=00s  "
"1","
"
"2","Calculating gene variances"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"2","Calculating feature variances of standardized and clipped values"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"2","Performing log-normalization
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"1",""
"1"," "
"1"," |                                                  |"
"1"," "
"1","0 % ~calculating  "
"1",""
"1"," "
"1"," |+++                                               |"
"1"," "
"1","5 % ~00s          "
"1",""
"1"," "
"1"," |+++++                                             |"
"1"," "
"1","10% ~00s          "
"1",""
"1"," "
"1"," |++++++++                                          |"
"1"," "
"1","15% ~00s          "
"1",""
"1"," "
"1"," |++++++++++                                        |"
"1"," "
"1","20% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++                                     |"
"1"," "
"1","25% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++                                   |"
"1"," "
"1","30% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++                                |"
"1"," "
"1","35% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++                              |"
"1"," "
"1","40% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++                           |"
"1"," "
"1","45% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++                         |"
"1"," "
"1","50% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++                      |"
"1"," "
"1","55% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++                    |"
"1"," "
"1","60% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++                 |"
"1"," "
"1","65% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++               |"
"1"," "
"1","70% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++            |"
"1"," "
"1","75% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++          |"
"1"," "
"1","80% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++       |"
"1"," "
"1","85% ~00s          "
"1",""
"1"," "
"1"," |+++++++++++++++++++++++++++++++++++++++++++++     |"
"1"," "
"1","90% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++  |"
"1"," "
"1","95% ~00s          "
"1",""
"1"," "
"1"," |++++++++++++++++++++++++++++++++++++++++++++++++++|"
"1"," "
"1","100% elapsed=00s  "
"1","
"
"2","Calculating gene variances"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"2","Calculating feature variances of standardized and clipped values"
"2","
"
"2","0%   10   20   30   40   50   60   70   80   90   100%
"
"2","[----|----|----|----|----|----|----|----|----|----|
"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","*"
"2","|
"
"0","# Merge into a cohesive list of variable transcripts, keeping only those which are shared between all individual lists"
"0","var.features <- Reduce(intersect, list(features.list[[1]],"
"0","                                   features.list[[2]],"
"0","                                   features.list[[3]]))"
"0","# Merge all three samples into a single object for joint analysis of cells"
"0","PBMCs <- merge(PBMCs.list[[1]], y = c(PBMCs.list[[2]], PBMCs.list[[3]]),"
"0","               project = ""PBMCs"")"
"0","# Update variable genes in object"
"0","PBMCs@assays$RNA@var.features <- var.features"
"0","# Scale data and generate PBMCs"
"0","PBMCs <- PBMCs %>%"
"0","         ScaleData() %>% "
"0","         RunPCA(npcs = 30)"
"2","  |                                                                                                                                    "
"2","  |                                                                                                                              |   0%"
"2","  |                                                                                                                                    "
"2","  |==============================================================================================================================| 100%"
"2","
"
